{% extends 'base.html' %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h2 class="fw-bold text-primary">Memoria Técnica del Proyecto</h2>
            <p class="text-muted">Evidencia de competencias y justificación arquitectónica - Dashboard I. Municipalidad de Puyehue</p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="accordion shadow-sm" id="accordionMemoria">
                
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                            <strong>1. Fundamentación: Arquitectura MVT y Seguridad</strong>
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionMemoria">
                        <div class="accordion-body">
                            <p>El proyecto usa la arquitectura **MVT (Modelo-Vista-Template)** y el principio "baterías incluidas" de Django para garantizar la **seguridad** (XSS/CSRF) y **escalabilidad** del sistema.</p>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                            <strong>2. Integración de Django con Bases de Datos (ORM)</strong>
                        </button>
                    </h2>
                    <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionMemoria">
                        <div class="accordion-body">
                            <p>La integración con la base de datos se maneja a través del **ORM (Mapeo Objeto-Relacional)**, el cual permite:</p>
                            <ul>
                                <li>**Abstracción:** Tratar las tablas SQL (ej: `ActividadProyecto`) como clases Python.</li>
                                <li>**Compatibilidad:** Django se integra con SQLite (usado actualmente), PostgreSQL, MySQL/MariaDB y Oracle, simplemente modificando la configuración en **`settings.py`**.</li>
                                <li>**Configuración:** La conexión se gestiona en el diccionario <code>DATABASES</code> de <code>settings.py</code>, definiendo el motor (Engine), nombre y credenciales.</li>
                                <li>**Operaciones:** Todas las operaciones (CRUD, Filtrado, Agregación) se realizan con métodos Python (<code>.filter()</code>, <code>.save()</code>, <code>.aggregate()</code>) sin necesidad de escribir SQL crudo.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                            <strong>3. Modelado Relacional (1:1, 1:M, M:M)</strong>
                        </button>
                    </h2>
                    <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionMemoria">
                        <div class="accordion-body">
                            <p>Se demostró el modelado de entidades interconectadas, propagando los cambios mediante migraciones:</p>
                            <ul>
                                <li>**Uno a Uno (1:1):** Modelo <code>PerfilFuncionario</code> extendiendo el usuario base de Django.</li>
                                <li>**Uno a Muchos (1:M):** El modelo <code>Proyecto</code> se relaciona con varias <code>ActividadProyecto</code> a través de una <code>ForeignKey</code>.</li>
                                <li>**Muchos a Muchos (M:M):** El modelo <code>Proyecto</code> tiene relación con varios <code>ComiteTecnico</code>.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingFour">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                            <strong>4. Consultas y Migraciones Avanzadas</strong>
                        </button>
                    </h2>
                    <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#accordionMemoria">
                        <div class="accordion-body">
                            <ul>
                                <li>**Migraciones:** Se ejecutaron migraciones para propagar todos los cambios relacionales al esquema de base de datos (<code>makemigrations</code> / <code>migrate</code>).</li>
                                <li>**Consultas Avanzadas:** Se utilizó el ORM para crear consultas complejas, demostradas en la vista de reportes.</li>
                            </ul>
                            <p><strong>Evidencia ORM Avanzado:</strong> La vista <code>reporte_gestion</code> utiliza los métodos <code>.filter()</code>, <code>.values()</code>, <code>.annotate(Count())</code> y <code>.order_by()</code> para generar informes analíticos sin usar SQL crudo.</p>
                        </div>
                    </div>
                </div>

            </div>
            
            <div class="mt-4 text-center">
                <a href="{% url 'dashboard' %}" class="btn btn-outline-primary">Volver al Dashboard</a>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}